<!DOCTYPE html>
<html>
<head>
  <title>Universal Clipboard Sync</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    h2 { margin-top: 0; }
    ul { padding-left: 20px; }
    li { cursor: pointer; }
  </style>
</head>
<body>
  <h2>Universal Clipboard Sync</h2>
  <p>Status: <b>Running</b></p>

  <h3>Connected Devices</h3>
  <ul id="devices"></ul>

  <h3>Clipboard History</h3>
  <ul id="history"></ul>

  <script>
    const { ipcRenderer } = require("electron");

    ipcRenderer.on("devices:update", (_, devices) => {
      const ul = document.getElementById("devices");
      ul.innerHTML = "";

      if (devices.length === 0) {
        ul.innerHTML = "<li>No devices connected</li>";
        return;
      }

      devices.forEach(d => {
        const li = document.createElement("li");
        li.textContent = d;
        ul.appendChild(li);
      });
    });

    ipcRenderer.on("history:update", (_, history) => {
      const ul = document.getElementById("history");
      ul.innerHTML = "";

      if (history.length === 0) {
        ul.innerHTML = "<li>No clipboard history</li>";
        return;
      }

      history.slice().reverse().forEach(item => {
        const li = document.createElement("li");
        li.textContent = item.content;
        li.onclick = () => {
          ipcRenderer.send("history:restore", item.content);
        };
        ul.appendChild(li);
      });
    });
  </script>


  <div style="background: #f5f5f5; padding: 10px; margin-bottom: 20px;">
    <h3>Connection</h3>
    <input type="text" id="pinInput" placeholder="Enter PIN (e.g. 1234)" />
    <button onclick="connectToRoom()">Connect</button>
    <button onclick="showQR()">Show QR</button>
    <div id="qr-container" style="margin-top:10px;"></div>
</div>

<script>
    // ... existing ipcRenderer requires ...

    function connectToRoom() {
        const pin = document.getElementById('pinInput').value;
        if(pin) {
            ipcRenderer.send("ui:connect", pin);
        }
    }

    async function showQR() {
        const pin = document.getElementById('pinInput').value || "1234"; // Default or random
        const qrData = JSON.stringify({ pin: pin, action: 'join' });
        
        // Use invoke for async response
        const url = await ipcRenderer.invoke("ui:generate-qr", qrData);
        document.getElementById('qr-container').innerHTML = `<img src="${url}" width="150"/>`;
    }
</script>
</body>
</html>
